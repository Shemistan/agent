# Agent Service

–≠—Ç–∞–ª–æ–Ω–Ω—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å —Å —á–∏—Å—Ç–æ–π —Å–ª–æ–∏—Å—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π –Ω–∞ Go.

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [DEPLOYMENT.md](DEPLOYMENT.md) - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –¥–µ–ø–ª–æ—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ GitHub Actions
- [TROUBLESHOOTING.md](TROUBLESHOOTING.md) - –†–µ—à–µ–Ω–∏–µ —Ç–∏–ø–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
cmd/
  ‚îú‚îÄ‚îÄ agent/           # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ —Å–µ—Ä–≤–∏—Å–∞ agent
  ‚îî‚îÄ‚îÄ migrator/        # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –º–∏–≥—Ä–∞—Ü—ñ–π

internal/
  ‚îú‚îÄ‚îÄ app/
  ‚îÇ   ‚îú‚îÄ‚îÄ agent/       # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è agent
  ‚îÇ   ‚îî‚îÄ‚îÄ migrator/    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü—ñ–π
  ‚îú‚îÄ‚îÄ api/
  ‚îÇ   ‚îî‚îÄ‚îÄ agent/       # HTTP handlers –∏ routing
  ‚îú‚îÄ‚îÄ service/
  ‚îÇ   ‚îú‚îÄ‚îÄ service.go   # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ —Å–ª–æ—è
  ‚îÇ   ‚îî‚îÄ‚îÄ agent/       # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤—ñ—Å—ñ–≤
  ‚îú‚îÄ‚îÄ storage/
  ‚îÇ   ‚îú‚îÄ‚îÄ storage.go   # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
  ‚îÇ   ‚îî‚îÄ‚îÄ agent/       # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è PostgreSQL —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
  ‚îî‚îÄ‚îÄ config/          # –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

migration/             # SQL –º–∏–≥—Ä–∞—Ü—ñ—ó
```

## HTTP endpoints

### GET /health
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–∞ –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤—ã–∑–æ–≤ –≤ –ë–î.

**Response (200 OK):**
```json
{"status":"success"}
```

### GET /check-manager
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–¥–æ—Ä–æ–≤—å–µ –≤—Å–µ—Ö –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ manager –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –ë–î.

**Response (200 OK - –≤—Å–µ —É—Å–ø–µ—à–Ω–æ):**
```json
{
  "status": "success",
  "managers": [
    {
      "manager_url": "http://localhost:8081",
      "status": "success",
      "http_status": 200
    },
    {
      "manager_url": "https://manager2:8443",
      "status": "success",
      "http_status": 200
    }
  ]
}
```

**Response (200 OK - –æ–¥–Ω–∞ –æ—à–∏–±–∫–∞):**
```json
{
  "status": "error",
  "managers": [
    {
      "manager_url": "http://localhost:8081",
      "status": "success",
      "http_status": 200
    },
    {
      "manager_url": "https://manager2:8443",
      "status": "error",
      "http_status": 500,
      "error": "unexpected HTTP status: 500"
    }
  ]
}
```

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Go 1.23.4+
- PostgreSQL 12+
- Docker (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### app.toml
–û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–Ω–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ):

```toml
service_name = "agent"
service_env = "local"
http_port = 8080

[database]
host = "localhost"
port = 5432
user = "agent_user"
name = "agent_db"
sslmode = "disable"

[tls]
enabled = false
cert_file = ""
key_file = ""
ca_file = ""

[manager]
urls = ["http://localhost:8081"]
timeout_seconds = 5
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

#### Database
```
DB_HOST=localhost           # PostgreSQL —Ö–æ—Å—Ç
DB_PORT=5432               # PostgreSQL –ø–æ—Ä—Ç
DB_USER=agent_user         # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ë–î
DB_PASSWORD=agent_password # –ü–∞—Ä–æ–ª—å –ë–î
DB_NAME=agent_db           # –ò–º—è –ë–î
DB_SSLMODE=disable         # SSL —Ä–µ–∂–∏–º (disable/require)
```

#### Application
```
APP_PORT=8080              # –ü–æ—Ä—Ç HTTP —Å–µ—Ä–≤–µ—Ä–∞
```

#### Manager (–Ω–µ—Å–∫–æ–ª—å–∫–æ manager-–æ–≤ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)
```
MANAGER_URLS=https://185.211.170.173:8443,https://92.63.177.186:8443
MANAGER_TIMEOUT=5          # –¢–∞–π–º–∞—É—Ç –≤ —Å–µ–∫—É–Ω–¥–∞—Ö –¥–ª—è manager –∑–∞–ø—Ä–æ—Å–æ–≤
```

#### TLS (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ—Ç–∫–ª—é—á–µ–Ω)
```
TLS_ENABLED=false          # –í–∫–ª—é—á–∏—Ç—å TLS (true/false)
TLS_CERT_FILE=             # –ü—É—Ç—å –∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—É —Å–µ—Ä–≤–µ—Ä–∞
TLS_KEY_FILE=              # –ü—É—Ç—å –∫ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º—É –∫–ª—é—á—É —Å–µ—Ä–≤–µ—Ä–∞
TLS_CA_FILE=               # –ü—É—Ç—å –∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—É CA –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ client cert
```

–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `.env` —Ñ–∞–π–ª:
```bash
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Å –Ω—É–∂–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
```

## –ó–∞–ø—É—Å–∫

### –ß–µ—Ä–µ–∑ Docker Compose (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

#### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
./start.sh
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –û—á–∏—Å—Ç–∏—Ç —Å—Ç–∞—Ä—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ volumes
- –ó–∞–≥—Ä—É–∑–∏—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ `.env` —Ñ–∞–π–ª–∞
- –°–æ–±–µ—Ä–µ—Ç –∏ –∑–∞–ø—É—Å—Ç–∏—Ç –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
- –ü—Ä–æ–≤–µ—Ä–∏—Ç —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤

#### –í–∞—Ä–∏–∞–Ω—Ç 2: –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ –æ—á–∏—Å—Ç–∏—Ç–µ volumes
docker-compose down -v

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å —á–∏—Å—Ç—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ .env
env -i $(cat .env | xargs) docker-compose up --build -d
```

**‚ö†Ô∏è –í–∞–∂–Ω–æ:** –ï—Å–ª–∏ —É –≤–∞—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `DB_PASSWORD`), –æ–Ω–∏ –±—É–¥—É—Ç –∏–º–µ—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ `.env` —Ñ–∞–π–ª–æ–º. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç `start.sh` –∏–ª–∏ –∫–æ–º–∞–Ω–¥—É —Å `env -i` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã.

–≠—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç:
1. PostgreSQL –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (–ø–æ—Ä—Ç 54322)
2. Migrator –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
3. Agent —Å–µ—Ä–≤–∏—Å –Ω–∞ –ø–æ—Ä—Ç—É 8081

### –õ–æ–∫–∞–ª—å–Ω–æ (–ø—Ä–∏ –∑–∞–ø—É—â–µ–Ω–Ω–æ–π –ë–î)

#### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ë–î

```bash
# –°–æ–∑–¥–∞–π—Ç–µ –ë–î –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω—ã)
psql -U postgres -c "CREATE USER agent_user WITH PASSWORD 'agent_password';"
psql -U postgres -c "CREATE DATABASE agent_db OWNER agent_user;"
```

#### 2. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

```bash
export DB_USER=agent_user
export DB_PASSWORD=agent_password
go run ./cmd/migrator/main.go migration
```

#### 3. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞

```bash
export DB_USER=agent_user
export DB_PASSWORD=agent_password
go run ./cmd/agent/main.go
```

–ò–ª–∏ –ø—Ä—è–º–æ:
```bash
export DB_USER=agent_user DB_PASSWORD=agent_password
./agent
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤

```bash
go test ./...
```

### –° –ø–æ–¥—Ä–æ–±–Ω—ã–º –≤—ã–≤–æ–¥–æ–º

```bash
go test ./... -v
```

### –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–∞–∫–µ—Ç–∞

```bash
go test ./internal/service/agent -v
```

## –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

### Health check

```bash
curl -X GET http://localhost:8081/health
```

### Check manager

```bash
curl -X GET http://localhost:8081/check-manager
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î

```bash
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
docker-compose exec db psql -U user -d pgsql_db_agent

# –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—ã–∑–æ–≤–æ–≤ health endpoint
docker-compose exec db psql -U user -d pgsql_db_agent -c "SELECT * FROM health_calls;"

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ–≤–µ—Ä–æ–∫ manager
docker-compose exec db psql -U user -d pgsql_db_agent -c "SELECT * FROM manager_checks;"
```

## –°–±–æ—Ä–∫–∞

### –°–±–æ—Ä–∫–∞ –±–∏–Ω–∞—Ä–Ω–∏–∫–æ–≤

```bash
go build -o agent ./cmd/agent/main.go
go build -o migrator ./cmd/migrator/main.go
```

### –°–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–∞

```bash
docker build -t agent:latest .
```

## –ë–î —Å—Ö–µ–º–∞

### health_calls
–¢–∞–±–ª–∏—Ü–∞ –∑–∞–ø–∏—Å–µ–π –≤—ã–∑–æ–≤–æ–≤ /health endpoint:

```
id              SERIAL PRIMARY KEY
called_at       TIMESTAMPTZ NOT NULL
```

### manager_checks
–¢–∞–±–ª–∏—Ü–∞ –∑–∞–ø–∏—Å–µ–π –ø—Ä–æ–≤–µ—Ä–æ–∫ health –º–µ–Ω–µ–¥–∂–µ—Ä–∞:

```
id              SERIAL PRIMARY KEY
checked_at      TIMESTAMPTZ NOT NULL
manager_url     TEXT NOT NULL
status          TEXT NOT NULL ('success' –∏–ª–∏ 'error')
http_status     INT NULL
error_message   TEXT NULL
```

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∫–æ–¥–∞

- **–ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ —Å–ª–æ–∏ (API ‚Üí Service ‚Üí Storage)
- **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã**: –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç–∏
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π slog –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ context –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–∞–π–º–∞—É—Ç–∞–º–∏
- **–¢–µ—Å—Ç—ã**: Unit —Ç–µ—Å—Ç—ã —Å mock –æ–±—ä–µ–∫—Ç–∞–º–∏
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö manager —Å–µ—Ä–≤–∏—Å–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

## TLS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–æ—Ç–∫–ª—é—á–µ–Ω–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

–°–µ—Ä–≤–∏—Å –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é mTLS (mutual TLS) –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏. –í –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç TLS –æ—Ç–∫–ª—é—á–µ–Ω, –Ω–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∫–ª—é—á–µ–Ω–∏–µ.

### –í–∫–ª—é—á–µ–Ω–∏–µ TLS

–î–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è HTTPS –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –∫–ª–∏–µ–Ω—Ç–∞:

1. **–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã:**
   ```bash
   # –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∏ –∫–ª—é—á —Å–µ—Ä–≤–µ—Ä–∞
   openssl req -x509 -newkey rsa:4096 -keyout server.key -out server.crt -days 365 -nodes

   # CA —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ client cert (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è mTLS)
   ```

2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
   ```bash
   export TLS_ENABLED=true
   export TLS_CERT_FILE=/path/to/server.crt
   export TLS_KEY_FILE=/path/to/server.key
   export TLS_CA_FILE=/path/to/ca.crt  # –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ client cert
   ```

3. **–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å:**
   ```bash
   go run ./cmd/agent/main.go
   ```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã TLS

- **TLS_ENABLED**: –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å TLS (true/false, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é false)
- **TLS_CERT_FILE**: –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É —Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º —Å–µ—Ä–≤–µ—Ä–∞ (*.crt)
- **TLS_KEY_FILE**: –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É —Å –ø—Ä–∏–≤–∞—Ç–Ω—ã–º –∫–ª—é—á–æ–º —Å–µ—Ä–≤–µ—Ä–∞ (*.key)
- **TLS_CA_FILE**: –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É —Å CA —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ client cert (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö Manager —Å–µ—Ä–≤–∏—Å–æ–≤

Agent –º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö manager —Å–µ—Ä–≤–∏—Å–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ:

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–£–∫–∞–∂–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ URL —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
export MANAGER_URLS=https://185.211.170.173:8443,https://92.63.177.186:8443
go run ./cmd/agent/main.go
```

–ò–ª–∏ –≤ `app.toml`:

```toml
[manager]
urls = [
  "https://185.211.170.173:8443",
  "https://92.63.177.186:8443"
]
timeout_seconds = 5
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏

Endpoint `/check-manager` –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å –≤—Å–µ URL –∏ –≤–µ—Ä–Ω—ë—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ:

```json
{
  "status": "error",
  "managers": [
    {
      "manager_url": "https://185.211.170.173:8443",
      "status": "success",
      "http_status": 200
    },
    {
      "manager_url": "https://92.63.177.186:8443",
      "status": "error",
      "http_status": 503,
      "error": "unexpected HTTP status: 503"
    }
  ]
}
```

**–û–±—â–∏–π —Å—Ç–∞—Ç—É—Å** (`status`) –±—É–¥–µ—Ç `"error"` –µ—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω manager –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
